spec:
  templates:
    - name: optimize-variational-circuit
      parent: generic-task
      inputs:
        parameters:
          - name: backend-specs
          - name: optimizer-specs
          - name: cost-function-specs
          - name: command
            value: bash main_script.sh
        artifacts:
          - name: ansatz
            path: /app/ansatz.json
          - name: initial-parameters
            path: /app/initial_parameters.json
          - name: qubit-operator
            path: /app/qubitop.json
          - name: noise-model
            path: /app/noise_model.json
            optional: True
          - name: device-connectivity
            path: /app/device_connectivity.json
            optional: True
          - name: parameter-grid
            path: /app/parameter_grid.json
            optional: True
          - name: constraint-operator
            path: /app/constraint_operator.json
            optional: True
          - name: main-script
            path: /app/main_script.sh
            raw:
              data: |
                qvm -S &
                quilc -S &
                source /app/usr/local/bin/compilers_and_libraries.sh
                python3 python_script.py
          - name: python-script
            path: /app/python_script.py
            raw:
              data: |
                from zquantum.optimizers.utils import optimize_variational_circuit

                optimizer_specs = {{inputs.parameters.optimizer-specs}}
                backend_specs = {{inputs.parameters.backend-specs}}
                cost_function_specs = {{inputs.parameters.cost-function-specs}}
                optimize_variational_circuit(optimizer_specs, backend_specs, cost_function_specs)
        outputs:
          artifacts:
            - name: optimization-results
              path: /app/optimization-results.json
            - name: optimized-parameters
              path: /app/optimized_parameters.json
